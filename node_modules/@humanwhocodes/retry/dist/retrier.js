const a480_0x1b3067=a480_0x87c9;(function(_0x39a7a1,_0x26eef3){const _0x11085b=a480_0x87c9,_0x14c1d7=_0x39a7a1();while(!![]){try{const _0x307a55=parseInt(_0x11085b(0x18c))/0x1+-parseInt(_0x11085b(0x15a))/0x2+parseInt(_0x11085b(0x190))/0x3+parseInt(_0x11085b(0x193))/0x4*(parseInt(_0x11085b(0x148))/0x5)+-parseInt(_0x11085b(0x167))/0x6*(parseInt(_0x11085b(0x172))/0x7)+-parseInt(_0x11085b(0x174))/0x8*(parseInt(_0x11085b(0x183))/0x9)+-parseInt(_0x11085b(0x15c))/0xa*(-parseInt(_0x11085b(0x163))/0xb);if(_0x307a55===_0x26eef3)break;else _0x14c1d7['push'](_0x14c1d7['shift']());}catch(_0x18a779){_0x14c1d7['push'](_0x14c1d7['shift']());}}}(a480_0x1762,0x64fb2));const MAX_TASK_TIMEOUT=0xea60,MAX_TASK_DELAY=0x64,MAX_CONCURRENCY=0x3e8;function debug(_0x2ec9b7){const _0x210df3=a480_0x87c9,_0x9889cb={'hpvNi':function(_0x17849e,_0x195a7f){return _0x17849e===_0x195a7f;},'ZrsFn':'@hwc/retry'};_0x9889cb[_0x210df3(0x181)](globalThis?.[_0x210df3(0x168)]?.['env'][_0x210df3(0x15f)],_0x9889cb[_0x210df3(0x16a)])&&console[_0x210df3(0x152)](_0x2ec9b7);}function isTimeToRetry(_0x2e9147,_0x14ff44){const _0x1ba084=a480_0x87c9,_0x7585fc={'WCsnJ':function(_0x1b6f70,_0x59a046){return _0x1b6f70-_0x59a046;},'CAtqu':function(_0x43a780,_0x43a6f8){return _0x43a780-_0x43a6f8;}},_0x55598a=_0x7585fc[_0x1ba084(0x182)](Date['now'](),_0x2e9147[_0x1ba084(0x14e)]),_0x491c30=Math['max'](_0x7585fc[_0x1ba084(0x178)](_0x2e9147[_0x1ba084(0x14e)],_0x2e9147[_0x1ba084(0x14b)]),0x1),_0x31d4ba=Math[_0x1ba084(0x18f)](_0x491c30*1.2,_0x14ff44);return _0x55598a>=_0x31d4ba;}function isTimeToBail(_0x23643d,_0x264c26){const _0x4e759e={'orwUI':function(_0x1ea958,_0x2bc19c){return _0x1ea958>_0x2bc19c;}};return _0x4e759e['orwUI'](_0x23643d['age'],_0x264c26);}function a480_0x1762(){const _0x1d9556=['\x20was\x20aborted\x20due\x20to\x20AbortSignal.','Processing\x20retry\x20queue:\x20','timestamp','vPBRm','Result\x20is\x20not\x20a\x20promise.','lastAttempt','DErYH','RXRDk','pHcsH','debug','ms.','ArUyR','Missing\x20function\x20to\x20check\x20errors','Processed\x20pending\x20tasks:\x20','signal','function','withResolvers','1497612KXSXQb','now','4444690ebhOyG','\x20retrying,\x20','Function\x20failed,\x20queuing\x20for\x20retry\x20with\x20task\x20','DEBUG','\x20was\x20abandoned\x20due\x20to\x20timeout.','then','yJCgq','33nVdBCC','Lxnds','DMcKe','\x20failed\x20with\x20non-retryable\x20error:\x20','6KdhLaw','process','gmGFL','ZrsFn','RELtI','finally','ZAYdT','toString','VEApJ','Promise\x20executor\x20did\x20not\x20initialize\x20resolve\x20or\x20reject.','ctdsB','1156421ELOPej','\x20pending,\x20','48yjKRxj','Task\x20','qAOhF','retrying','CAtqu','MOdoh','catch','error','\x20working.','resolve','age','push','working','hpvNi','WCsnJ','595323VoEnXo','Synchronous\x20error:\x20','Processing\x20pending\x20tasks:\x20','DjlHO','reject','shift','CBXVj','dONeH','pending','168736IVoSDb','EgATl','ekNOL','min','163053UwUGXh','message','split','20zwnGey','addEventListener','slice','njUtF','BYsDD','\x20succeeded\x20after\x20','keWDF','length','168015GKOYOf'];a480_0x1762=function(){return _0x1d9556;};return a480_0x1762();}function a480_0x87c9(_0x302b6b,_0x38d362){const _0x1762f0=a480_0x1762();return a480_0x87c9=function(_0x87c91a,_0xebfe6e){_0x87c91a=_0x87c91a-0x148;let _0x468a61=_0x1762f0[_0x87c91a];return _0x468a61;},a480_0x87c9(_0x302b6b,_0x38d362);}function createPromise(){const _0x2fd1f2=a480_0x87c9,_0x475a13={'VEApJ':function(_0x1bf560,_0x2fe10b){return _0x1bf560===_0x2fe10b;},'yJCgq':_0x2fd1f2(0x170)};if(Promise[_0x2fd1f2(0x159)])return Promise[_0x2fd1f2(0x159)]();let _0x1c444e,_0x33a910;const _0x2a8dbf=new Promise((_0x4d229b,_0x494c74)=>{_0x1c444e=_0x4d229b,_0x33a910=_0x494c74;});if(_0x1c444e===undefined||_0x475a13[_0x2fd1f2(0x16f)](_0x33a910,undefined))throw new Error(_0x475a13[_0x2fd1f2(0x162)]);return{'promise':_0x2a8dbf,'resolve':_0x1c444e,'reject':_0x33a910};}class RetryTask{['id']=Math['random']()[a480_0x1b3067(0x16e)](0x24)[a480_0x1b3067(0x195)](0x2);['fn'];[a480_0x1b3067(0x17b)];[a480_0x1b3067(0x14b)]=Date[a480_0x1b3067(0x15b)]();[a480_0x1b3067(0x14e)]=this[a480_0x1b3067(0x14b)];[a480_0x1b3067(0x17d)];[a480_0x1b3067(0x187)];[a480_0x1b3067(0x157)];constructor(_0x2e2d13,_0x47cbfa,_0x552460,_0x592728,_0x28b2ef){const _0x1871cb=a480_0x1b3067;this['fn']=_0x2e2d13,this[_0x1871cb(0x17b)]=_0x47cbfa,this[_0x1871cb(0x14b)]=Date[_0x1871cb(0x15b)](),this[_0x1871cb(0x14e)]=Date[_0x1871cb(0x15b)](),this[_0x1871cb(0x17d)]=_0x552460,this['reject']=_0x592728,this[_0x1871cb(0x157)]=_0x28b2ef;}get[a480_0x1b3067(0x17e)](){const _0x5cbcd1=a480_0x1b3067;return Date[_0x5cbcd1(0x15b)]()-this[_0x5cbcd1(0x14b)];}}class Retrier{#retrying=[];#pending=[];#working=0x0;#timeout;#maxDelay;#timerId;#check;#concurrency;constructor(_0x2bf68f,{timeout:timeout=MAX_TASK_TIMEOUT,maxDelay:maxDelay=MAX_TASK_DELAY,concurrency:concurrency=MAX_CONCURRENCY}={}){const _0x4853d7=a480_0x1b3067,_0x337372={'TnBOm':'0|3|4|1|2','lXgDT':function(_0x123a1,_0x33de05){return _0x123a1!==_0x33de05;},'njUtF':_0x4853d7(0x158),'ekNOL':_0x4853d7(0x155)},_0x40a967=_0x337372['TnBOm'][_0x4853d7(0x192)]('|');let _0x2aa95f=0x0;while(!![]){switch(_0x40a967[_0x2aa95f++]){case'0':if(_0x337372['lXgDT'](typeof _0x2bf68f,_0x337372[_0x4853d7(0x196)]))throw new Error(_0x337372[_0x4853d7(0x18e)]);continue;case'1':this.#maxDelay=maxDelay;continue;case'2':this.#concurrency=concurrency;continue;case'3':this.#check=_0x2bf68f;continue;case'4':this.#timeout=timeout;continue;}break;}}get[a480_0x1b3067(0x177)](){const _0x582f9e=a480_0x1b3067;return this.#retrying[_0x582f9e(0x19a)];}get['pending'](){const _0x36b316=a480_0x1b3067;return this.#pending[_0x36b316(0x19a)];}get[a480_0x1b3067(0x180)](){return this.#working;}#call(_0x1988a2,{signal:_0x3b2a84,promise:_0x2d9f0e,resolve:_0x1b6677,reject:_0x46a719}){const _0x2454aa=a480_0x1b3067,_0x1dc1f8={'Lxnds':function(_0x1000ae,_0xbe5ace){return _0x1000ae(_0xbe5ace);},'keWDF':'Function\x20called\x20successfully\x20without\x20retry.','DjlHO':function(_0x5945c5,_0x28cad9){return _0x5945c5(_0x28cad9);},'qAOhF':'abort','DErYH':function(_0x4f529d){return _0x4f529d();},'CBXVj':function(_0x1adabc,_0xaae95f){return _0x1adabc!==_0xaae95f;},'XNUod':_0x2454aa(0x14d)};let _0x39ed24;try{_0x39ed24=_0x1dc1f8[_0x2454aa(0x14f)](_0x1988a2);}catch(_0x279a91){return _0x46a719(new Error(_0x2454aa(0x184)+_0x279a91[_0x2454aa(0x191)],{'cause':_0x279a91})),_0x2d9f0e;}if(!_0x39ed24||_0x1dc1f8[_0x2454aa(0x189)](typeof _0x39ed24[_0x2454aa(0x161)],_0x2454aa(0x158)))return _0x1dc1f8[_0x2454aa(0x164)](_0x46a719,new Error(_0x1dc1f8['XNUod'])),_0x2d9f0e;return this.#working++,_0x2d9f0e[_0x2454aa(0x16c)](()=>{this.#working--,this.#processPending();})[_0x2454aa(0x17a)](()=>{}),Promise[_0x2454aa(0x17d)](_0x39ed24)[_0x2454aa(0x161)](_0x39fe32=>{const _0x2489fc=_0x2454aa;_0x1dc1f8[_0x2489fc(0x164)](debug,_0x1dc1f8[_0x2489fc(0x199)]),_0x1dc1f8[_0x2489fc(0x164)](_0x1b6677,_0x39fe32);})['catch'](_0x591f8d=>{const _0x514677=_0x2454aa;if(!this.#check(_0x591f8d)){_0x1dc1f8[_0x514677(0x186)](_0x46a719,_0x591f8d);return;}const _0x12a35c=new RetryTask(_0x1988a2,_0x591f8d,_0x1b6677,_0x46a719,_0x3b2a84);_0x1dc1f8[_0x514677(0x186)](debug,_0x514677(0x15e)+_0x12a35c['id']+'.'),this.#retrying[_0x514677(0x17f)](_0x12a35c),_0x3b2a84?.[_0x514677(0x194)](_0x1dc1f8[_0x514677(0x176)],()=>{const _0x3f1e20=_0x514677;debug(_0x3f1e20(0x175)+_0x12a35c['id']+_0x3f1e20(0x149)),_0x46a719(_0x3b2a84['reason']);}),this.#processQueue();}),_0x2d9f0e;}['retry'](_0x3afd3d,{signal:_0x1485d9}={}){const _0xf52b54=a480_0x1b3067,_0x4261db={'RELtI':function(_0x14c37c){return _0x14c37c();}};_0x1485d9?.['throwIfAborted']();const {promise:_0x770661,resolve:_0x3ed185,reject:_0x448ff7}=_0x4261db[_0xf52b54(0x16b)](createPromise);return this.#pending[_0xf52b54(0x17f)](()=>this.#call(_0x3afd3d,{'signal':_0x1485d9,'promise':_0x770661,'resolve':_0x3ed185,'reject':_0x448ff7})),this.#processPending(),_0x770661;}#processAll(){const _0x28a9de=a480_0x1b3067;this[_0x28a9de(0x18b)]&&this.#processPending(),this['retrying']&&this.#processQueue();}#processPending(){const _0x213200=a480_0x1b3067,_0x3b6b25={'QPYsB':function(_0xa67049,_0x57d115){return _0xa67049(_0x57d115);},'DMcKe':function(_0x2a4c17,_0x2e8f97){return _0x2a4c17<=_0x2e8f97;},'MOdoh':function(_0x1f4e5c,_0x1bbdf1){return _0x1f4e5c<_0x1bbdf1;},'iSZDA':function(_0x319c61){return _0x319c61();},'pHcsH':function(_0x16eafb,_0x2a2d41){return _0x16eafb(_0x2a2d41);}};_0x3b6b25['QPYsB'](debug,_0x213200(0x185)+this[_0x213200(0x18b)]+_0x213200(0x173)+this['working']+'\x20working.');const _0x19c6d1=this.#concurrency-this[_0x213200(0x180)];if(_0x3b6b25[_0x213200(0x165)](_0x19c6d1,0x0))return;const _0x34bd79=Math[_0x213200(0x18f)](this[_0x213200(0x18b)],_0x19c6d1);for(let _0x401d41=0x0;_0x3b6b25[_0x213200(0x179)](_0x401d41,_0x34bd79);_0x401d41++){const _0x15b91d=this.#pending[_0x213200(0x188)]();_0x3b6b25['iSZDA'](_0x15b91d);}_0x3b6b25[_0x213200(0x151)](debug,_0x213200(0x156)+this[_0x213200(0x18b)]+_0x213200(0x173)+this['working']+'\x20working.');}#processQueue(){const _0x3da022=a480_0x1b3067,_0x4e7a16={'ArUyR':function(_0xefb7ad,_0x1cce55){return _0xefb7ad(_0x1cce55);},'gmGFL':function(_0x2e4b4f,_0x5ca30b){return _0x2e4b4f(_0x5ca30b);},'EgATl':function(_0x4c1764,_0x4971d4){return _0x4c1764(_0x4971d4);},'dONeH':function(_0x2dfa41,_0x611cb9){return _0x2dfa41(_0x611cb9);},'ZAYdT':function(_0x612549,_0xf8dac1){return _0x612549(_0xf8dac1);},'RXRDk':function(_0x3d372a){return _0x3d372a();},'vPBRm':function(_0xa92089,_0x3228e3){return _0xa92089(_0x3228e3);},'ctdsB':function(_0x55208a){return _0x55208a();},'slhcY':function(_0x4952db,_0x1ada1a,_0x4d3852){return _0x4952db(_0x1ada1a,_0x4d3852);},'BYsDD':function(_0x514b99){return _0x514b99();}};_0x4e7a16[_0x3da022(0x18a)](clearTimeout,this.#timerId),this.#timerId=undefined,debug(_0x3da022(0x14a)+this[_0x3da022(0x177)]+_0x3da022(0x15d)+this[_0x3da022(0x180)]+_0x3da022(0x17c));const _0x290abf=()=>{this.#timerId=setTimeout(()=>this.#processAll(),0x0);},_0x2b2a79=this.#retrying[_0x3da022(0x188)]();if(!_0x2b2a79){_0x4e7a16[_0x3da022(0x16d)](debug,'Queue\x20is\x20empty,\x20exiting.');this[_0x3da022(0x18b)]&&_0x4e7a16[_0x3da022(0x150)](_0x290abf);return;}if(isTimeToBail(_0x2b2a79,this.#timeout)){_0x4e7a16[_0x3da022(0x14c)](debug,'Task\x20'+_0x2b2a79['id']+_0x3da022(0x160)),_0x2b2a79[_0x3da022(0x187)](_0x2b2a79[_0x3da022(0x17b)]),_0x4e7a16[_0x3da022(0x171)](_0x290abf);return;}if(!_0x4e7a16['slhcY'](isTimeToRetry,_0x2b2a79,this.#maxDelay)){_0x4e7a16[_0x3da022(0x169)](debug,_0x3da022(0x175)+_0x2b2a79['id']+'\x20is\x20not\x20ready\x20to\x20retry,\x20skipping.'),this.#retrying[_0x3da022(0x17f)](_0x2b2a79),_0x4e7a16[_0x3da022(0x197)](_0x290abf);return;}_0x2b2a79[_0x3da022(0x14e)]=Date[_0x3da022(0x15b)](),Promise[_0x3da022(0x17d)](_0x2b2a79['fn']())[_0x3da022(0x161)](_0x21a799=>{const _0x3f7895=_0x3da022;_0x4e7a16[_0x3f7895(0x154)](debug,_0x3f7895(0x175)+_0x2b2a79['id']+_0x3f7895(0x198)+_0x2b2a79[_0x3f7895(0x17e)]+_0x3f7895(0x153)),_0x2b2a79[_0x3f7895(0x17d)](_0x21a799);})['catch'](_0x233c3a=>{const _0x4bc601=_0x3da022;if(!this.#check(_0x233c3a)){_0x4e7a16[_0x4bc601(0x169)](debug,_0x4bc601(0x175)+_0x2b2a79['id']+_0x4bc601(0x166)+_0x233c3a['message']+'.'),_0x2b2a79['reject'](_0x233c3a);return;}_0x2b2a79[_0x4bc601(0x14e)]=Date[_0x4bc601(0x15b)](),this.#retrying['push'](_0x2b2a79),_0x4e7a16[_0x4bc601(0x18d)](debug,'Task\x20'+_0x2b2a79['id']+'\x20failed,\x20requeueing\x20to\x20try\x20again.');})[_0x3da022(0x16c)](()=>{this.#processAll();});}}export{Retrier};